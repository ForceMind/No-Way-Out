<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>无归之城｜No Way Out</title>
  <link rel="icon" href="icon.png" type="image/png">
  <style>
    body, html { margin:0; padding:0; height:100%; background:#000; font-family:Arial, sans-serif; color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; }
    #title-screen, #identity-screen, #dialogue-container { width:100%; height:100%; position:absolute; top:0; left:0; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px; }
    #title-screen, #identity-screen { background:linear-gradient(to bottom, #111, #333); }
    h1, h2, h3 { font-size:2em; margin-bottom:20px; }
    #start-btn, .identity-btn, .choice-btn { padding:10px 20px; font-size:1.2em; background:#000; color:#fff; border:2px solid #fff; cursor:pointer; margin:5px; }
    #start-btn:hover, .identity-btn:hover, .choice-btn:hover { background:#fff; color:#000; }
    #identity-list { display:flex; flex-wrap:wrap; justify-content:center; max-width:600px; }
    #dialogue-text { font-size:1.2em; margin-bottom:20px; }
    #identity-description { margin:10px 0; font-size:1.1em; color:#ccc; max-width:600px; }
  </style>
</head>
<body>
  <div id="title-screen">
    <h1>无归之城｜No Way Out</h1>
    <button id="start-btn">开始游戏</button>
  </div>
  <div id="identity-screen" style="display:none;">
    <h2 id="identity-title">选择你的身份</h2>
    <div id="intro-text">1937年冬天，南京城陷入战火。你将以不同的身份经历这座城的绝望与挣扎。选择一个身份，决定你的生死与命运。</div>
    <div id="identity-description"></div>
    <div id="identity-list"></div>
    <div>
      <button id="confirm-identity" style="display:none;">确认</button>
      <button id="reselect-identity" style="display:none;">重新选择</button>
    </div>
  </div>
  <div id="dialogue-container" style="display:none;">
    <div id="dialogue-text"></div>
    <div id="choices"></div>
  </div>
  <script>
    const identities = ["市民","难民","学生","教师","医生","商人","农夫","地下党员","孤儿","修女","流浪汉","车夫"];
    const identityDialogues = {
      "市民": "你是南京的普通市民，日军的铁蹄践踏了你的家园。",
      "难民": "你背井离乡，带着一家老小逃到南京城，却发现此处更危险。",
      "学生": "你是中央大学的学生，书本无法告诉你该如何面对眼前的屠戮。",
      "教师": "作为教师，你想保护学生，但力量显得渺小。",
      "医生": "你是城里的医生，满目疮痍让你不得不选择去救谁。",
      "商人": "你曾经富有，但财富换不来安全。",
      "农夫": "你是乡下的农夫，被逼进城找寻生路。",
      "地下党员": "你是地下工作者，使命是传递情报与救人。",
      "孤儿": "你无家可归，只能在废墟中寻找生存的机会。",
      "修女": "你在教堂里避难，想为弱者提供庇护。",
      "流浪汉": "你无处可去，只能在废墟间寻找残羹冷炙。",
      "车夫": "你拉着破车，载着希望与恐惧穿行于城中。"
    };

    const dialogues = {
     市民: {
        start: { text: "邻居：城中已不再安全，你要去哪里避难？", choices: [ {text:"去防空洞", next:"shelter"}, {text:"去教堂避难", next:"church"}, {text:"留在家中", next:"home"}, {text:"去亲戚家", next:"relative1"} ] },

        // 亲戚家分支
        relative1: { text: "你来到亲戚家，但发现家里没人，物资也所剩无几。", choices: [ {text:"翻找食物", next:"relative_food"}, {text:"上街寻找", next:"street1"}, {text:"继续等待", next:"relative_wait"} ] },
        relative_food: { text: "你找到一些干粮和一壶水。要不要再搜搜？", choices: [ {text:"继续搜寻", next:"relative_more"}, {text:"拿走现有食物", next:"relative_leave"} ] },
        relative_more: { text: "你翻开柜子，发现一张藏有暗门的地板。", choices: [ {text:"打开暗门", next:"relative_secret"}, {text:"不碰它", next:"relative_leave"} ] },
        relative_secret: { text: "暗门下面有些旧钱币和一把生锈的小刀。要拿走吗？", choices: [ {text:"拿走", next:"relative_leave"}, {text:"不拿", next:"relative_leave"} ] },
        relative_leave: { text: "你背上物资，天色渐暗。", choices: [ {text:"在亲戚家休息一晚", next:"relative_rest"}, {text:"直接离开", next:"street1"} ] },
        relative_rest: { text: "你睡得很不安稳，半夜听到敲门声。", choices: [ {text:"开门看看", next:"relative_open"}, {text:"继续装睡", next:"relative_hide"} ] },
        relative_open: { text: "门外是一名陌生难民，他请求留宿。", choices: [ {text:"允许他进来", next:"relative_guest"}, {text:"拒绝", next:"relative_hide"} ] },
        relative_guest: { text: "他和你分享了外面的情报：东门晚上有漏洞。", choices: [ {text:"前往东门", next:"east1"}, {text:"等待天亮", next:"relative_escape"} ] },
        relative_wait: { text: "夜里传来日军的脚步声。", choices: [ {text:"继续躲藏", next:"relative_hide"}, {text:"翻墙逃走", next:"street1"} ] },
        relative_hide: { text: "你屏住呼吸，日军翻找屋子但未发现你。", choices: [ {text:"等他们离开", next:"relative_escape"}, {text:"突然冲出", next:"ending_caught1"} ] },
        relative_escape: { text: "天亮后，你决定下一步行动。", choices: [ {text:"去教堂", next:"church"}, {text:"去防空洞", next:"shelter"}, {text:"上街", next:"street1"} ] },

        // 防空洞分支
        shelter: { text: "防空洞里挤满了人，空气混浊。你是继续待下去还是出去？", choices: [ {text:"继续待下去", next:"shelter_wait"}, {text:"离开", next:"street1"}, {text:"四处打听消息", next:"shelter_rumor"} ] },
        shelter_rumor: { text: "有人说北门昨晚有人逃出去。你要相信吗？", choices: [ {text:"去北门", next:"north1"}, {text:"留在防空洞", next:"shelter_wait"} ] },
        north1: { text: "北门戒备森严，但有一条小巷通往后方。", choices: [ {text:"潜行小巷", next:"north_sneak"}, {text:"回头", next:"street2"} ] },
        north_sneak: { text: "你踩到碎石发出响声，一名士兵转头。", choices: [ {text:"藏身墙角", next:"north_hide"}, {text:"冲过去", next:"ending_caught1"} ] },
        north_hide: { text: "你屏住呼吸，士兵没有发现你。", choices: [ {text:"沿小巷前进", next:"north_escape"}, {text:"返回", next:"street2"} ] },
        north_escape: { text: "小巷通向一条河沟，可能通向城外。", choices: [ {text:"顺河沟走", next:"ending_escape_river"}, {text:"返回", next:"street2"} ] },
        shelter_wait: { text: "一位老人咳嗽不停，你要帮他吗？", choices: [ {text:"递水", next:"help_old"}, {text:"无视", next:"ignore_old"} ] },
        help_old: { text: "老人感激地告诉你西门有秘密通道。", choices: [ {text:"去西门", next:"west1"}, {text:"留下", next:"shelter_stay"} ] },
        ignore_old: { text: "轰炸声逼近，防空洞震动。", choices: [ {text:"继续待下去", next:"shelter_shake"}, {text:"逃出", next:"street1"} ] },
        shelter_shake: { text: "防空洞入口塌陷。你要挖出口吗？", choices: [ {text:"尝试挖出口", next:"dig_exit"}, {text:"等待救援", next:"ending_dead1"} ] },
        shelter_stay: { text: "空气愈加稀薄。", choices: [ {text:"尝试挖出口", next:"dig_exit"}, {text:"等待救援", next:"ending2"} ] },
        dig_exit: { text: "你找到裂缝通向外面。", choices: [ {text:"去河边", next:"river1"}, {text:"去西门", next:"west1"} ] },

        // 街道与巡逻分支
        street1: { text: "街上有日军巡逻，你要怎么做？", choices: [ {text:"躲藏", next:"hide1"}, {text:"假装镇定走过", next:"pass1"}, {text:"沿小路绕行", next:"street3"} ] },
        street3: { text: "小路杂草丛生，你踩到铁罐发出声响。", choices: [ {text:"躲在草丛", next:"hide_grass"}, {text:"快速离开", next:"street2"} ] },
        hide_grass: { text: "士兵巡逻过来，几乎踩到你。你准备怎么办？", choices: [ {text:"屏住呼吸", next:"hide_grass2"}, {text:"投掷石头引开", next:"hide_grass_stone"} ] },
        hide_grass2: { text: "士兵停顿片刻然后离开，你出了一身冷汗。", choices: [ {text:"继续前行", next:"street2"}, {text:"等更久再走", next:"street2_wait"} ] },
        hide_grass_stone: { text: "石头吸引了士兵的注意力，他们走向另一边。", choices: [ {text:"趁机离开", next:"street2"}, {text:"再等一会儿", next:"street2_wait"} ] },
        street2_wait: { text: "你又等了几分钟，夜色更深，街道更安静。", choices: [ {text:"继续走向三岔口", next:"street2"}, {text:"回头", next:"street1"} ] },

        pass1: { text: "日军对你投来怀疑的目光，你要怎么办？", choices: [ {text:"加快脚步", next:"pass2"}, {text:"走进小巷", next:"street2"} ] },
        pass2: { text: "你加快了脚步，士兵大声喝令你停下。", choices: [ {text:"解释自己是百姓", next:"pass_explain"}, {text:"继续跑", next:"ending_caught1"} ] },
        pass_explain: { text: "士兵狐疑地打量你。", choices: [ {text:"低头赔笑", next:"street2"}, {text:"掏钱贿赂", next:"pass_bribe"} ] },
        pass_bribe: { text: "你递出一些钱币，士兵将你赶走。", choices: [ {text:"赶快离开", next:"street2"} ] },

        hide1: { text: "你躲进废墟，一名小孩哭了。你帮他吗？", choices: [ {text:"安抚小孩", next:"help_child"}, {text:"离开", next:"leave_child"} ] },
        help_child: { text: "小孩告诉你教堂安全，还给了你一块干面包。", choices: [ {text:"去教堂", next:"church"}, {text:"继续前行", next:"street2"} ] },
        leave_child: { text: "你甩开小孩，继续走。前面有士兵拦路。", choices: [ {text:"绕路", next:"street2"}, {text:"硬闯", next:"ending_caught1"} ] },
        street2: { text: "前面分三条路：东门、西门、河边。", choices: [ {text:"去东门", next:"east1"}, {text:"去西门", next:"west1"}, {text:"去河边", next:"river1"} ] },

        // 东门与西门
        east1: { text: "东门被封锁。守卫要通行证。", choices: [ {text:"尝试贿赂", next:"bribe1"}, {text:"寻找别路", next:"street2"} ] },
        bribe1: { text: "你拿出钱，守卫犹豫不决。", choices: [ {text:"再给多点", next:"ending_caught1"}, {text:"换条路走", next:"street2"} ] },
        west1: { text: "西门有秘密通道，但有匪徒。", choices: [ {text:"与匪徒谈判", next:"bandit1"}, {text:"寻找其他路", next:"street2"} ] },
        bandit1: { text: "匪徒要求交换物资。", choices: [ {text:"交出手表", next:"ending_caught_bandit"}, {text:"拒绝", next:"fight_bandit"} ] },
        fight_bandit: { text: "你试图打斗但受伤。", choices: [ {text:"逃跑", next:"street2"}, {text:"求饶", next:"ending_caught_bandit"} ] },

        // 河边分支
        river1: { text: "河边有小船，但需要撑过去。你要尝试吗？", choices: [ {text:"直接划船", next:"river_row"}, {text:"返回", next:"street2"}, {text:"等夜晚", next:"river_night"} ] },
        river_row: { text: "你推船入水，水流湍急。是否继续？", choices: [ {text:"坚持划过去", next:"ending_escape_river"}, {text:"靠岸返回", next:"street2"} ] },
        river_night: { text: "夜晚河面起雾，视线很差。你看到一个黑影漂浮在水上。", choices: [ {text:"探查黑影", next:"river_shadow"}, {text:"绕开继续划", next:"ending_escape_river"} ] },
        river_shadow: { text: "那是一具尸体，手里还抓着一个包裹。要拿吗？", choices: [ {text:"取包裹", next:"river_package"}, {text:"不拿", next:"ending_escape_river"} ] },
        river_package: { text: "包裹里有些钱和一张地图，你带着它继续划船。", choices: [ {text:"利用地图找出口", next:"ending_escape_river"} ] },

        // 教堂分支
        church: { text: "教堂里有修女和难民。修女邀请你帮忙。", choices: [ {text:"帮忙", next:"church_help"}, {text:"离开", next:"street1"}, {text:"询问消息", next:"church_info"} ] },
        church_info: { text: "一名神父悄声告诉你：南门可能守备较松。", choices: [ {text:"去南门", next:"south1"}, {text:"留在教堂", next:"church_help"} ] },
        south1: { text: "南门附近有军犬巡逻。", choices: [ {text:"绕过军犬", next:"ending_escape_south"}, {text:"返回", next:"street2"} ] },
        church_help: { text: "你帮忙分发食物。有人问你要不要加入抵抗。", choices: [ {text:"加入", next:"resist1"}, {text:"拒绝", next:"church_stay"} ] },
        resist1: { text: "你加入了抵抗组织，是否行动？", choices: [ {text:"去救人", next:"rescue1"}, {text:"去收集情报", next:"intel1"} ] },
        rescue1: { text: "你救了几位市民，安全撤回。", choices: [ {text:"返回教堂", next:"church_stay"}, {text:"继续行动", next:"rescue2"} ] },
        rescue2: { text: "你再次出击，但遇到日军。", choices: [ {text:"交火", next:"ending_rescue_fail"}, {text:"撤退", next:"church_stay"} ] },
        intel1: { text: "你偷偷来到了日军营地外围。", choices: [ {text:"偷偷潜入", next:"ending_resist_win"}, {text:"害怕返回", next:"ending_resist_fail"} ] },
        church_stay: { text: "你留在教堂，暂时安全，但外界愈发危险。", choices: [ {text:"继续帮忙", next:"ending_safe"}, {text:"冒险离开", next:"street1"} ] },

        // 家中分支
        home: { text: "你躲在家里。外面越来越危险。", choices: [ {text:"继续等待", next:"ending1"}, {text:"出去看看", next:"street1"}, {text:"爬上屋顶观察", next:"home_roof"} ] },
        home_roof: { text: "你看到南边有火光，北边有巡逻士兵。", choices: [ {text:"去南边", next:"south1"}, {text:"去北边", next:"north1"} ] },

        // 结局
        ending1: { text: "系统：你留在家中，最终被日军抓走枪决（市民结局1）", choices: [] },
        ending2: { text: "系统：防空洞塌陷，你被埋在废墟（市民结局2）", choices: [] },
        ending3: { text: "系统：你搭上小船，却在河中央被日军巡逻艇发现射杀（市民结局3）", choices: [] },
        ending_caught1: { text: "系统：你被士兵抓住并处决（市民结局4）", choices: [] },
        ending_dead1: { text: "系统：你在塌陷中窒息死亡（市民结局5）", choices: [] },
        ending_escape_east: { text: "系统：你贿赂守卫后仍被反锁在城门内遭枪决（市民结局6）", choices: [] },
        ending_escape_west: { text: "系统：你试图通过西门秘密通道逃跑却被匪徒杀死（市民结局7）", choices: [] },
        ending_caught_bandit: { text: "系统：你被匪徒劫杀（市民结局8）", choices: [] },
        ending_escape_river: { text: "系统：划船时动作太大船翻了，你落水溺亡（市民结局9）", choices: [] },
        ending_escape_south: { text: "系统：你趁夜绕过军犬，却被埋伏的士兵发现枪杀（市民结局10）", choices: [] },
        ending_resist_win: { text: "系统：你被暗哨发现并射杀（市民结局9）", choices: [] },
        ending_resist_fail: { text: "系统：你待在教堂里，最后被日军坑杀（市民结局9）", choices: [] }

      // 市民: {
      //   start: { text: "邻居：城中已不再安全，你要去哪里避难？", choices: [ {text:"去防空洞", next:"shelter"}, {text:"去教堂避难", next:"church"}, {text:"留在家中", next:"home"}, {text:"去亲戚家", next:"relative1"} ] },

      //   // 亲戚家分支
      //   relative1: { text: "你来到亲戚家，但发现家里没人，物资也所剩无几。", choices: [ {text:"翻找食物", next:"relative_food"}, {text:"上街寻找", next:"street1"}, {text:"继续等待", next:"relative_wait"} ] },
      //   relative_food: { text: "你找到一些干粮和一壶水。要不要再搜搜？", choices: [ {text:"继续搜寻", next:"relative_more"}, {text:"拿走现有食物", next:"relative_leave"} ] },
      //   relative_more: { text: "你翻开柜子，发现一张藏有暗门的地板。", choices: [ {text:"打开暗门", next:"relative_secret"}, {text:"不碰它", next:"relative_leave"} ] },
      //   relative_secret: { text: "暗门下面有些旧钱币和一把生锈的小刀。要拿走吗？", choices: [ {text:"拿走", next:"relative_leave"}, {text:"不拿", next:"relative_leave"} ] },
      //   relative_leave: { text: "你背上物资，天色渐暗。", choices: [ {text:"在亲戚家休息一晚", next:"relative_rest"}, {text:"直接离开", next:"street1"} ] },
      //   relative_rest: { text: "你睡得很不安稳，半夜听到敲门声。", choices: [ {text:"开门看看", next:"relative_open"}, {text:"继续装睡", next:"relative_hide"} ] },
      //   relative_open: { text: "门外是一名陌生难民，他请求留宿。", choices: [ {text:"允许他进来", next:"relative_guest"}, {text:"拒绝", next:"relative_hide"} ] },
      //   relative_guest: { text: "他和你分享了外面的情报：东门晚上有漏洞。", choices: [ {text:"前往东门", next:"east1"}, {text:"等待天亮", next:"relative_escape"} ] },
      //   relative_wait: { text: "夜里传来日军的脚步声。", choices: [ {text:"继续躲藏", next:"relative_hide"}, {text:"翻墙逃走", next:"street1"} ] },
      //   relative_hide: { text: "你屏住呼吸，日军翻找屋子但未发现你。", choices: [ {text:"等他们离开", next:"relative_escape"}, {text:"突然冲出", next:"ending_caught1"} ] },
      //   relative_escape: { text: "天亮后，你决定下一步行动。", choices: [ {text:"去教堂", next:"church"}, {text:"去防空洞", next:"shelter"}, {text:"上街", next:"street1"} ] },

      //   // 防空洞分支
      //   shelter: { text: "防空洞里挤满了人，空气混浊。你是继续待下去还是出去？", choices: [ {text:"继续待下去", next:"shelter_wait"}, {text:"离开", next:"street1"}, {text:"四处打听消息", next:"shelter_rumor"} ] },
      //   shelter_rumor: { text: "有人说北门昨晚有人逃出去。你要相信吗？", choices: [ {text:"去北门", next:"north1"}, {text:"留在防空洞", next:"shelter_wait"} ] },
      //   north1: { text: "北门戒备森严，但有一条小巷通往后方。", choices: [ {text:"潜行小巷", next:"north_sneak"}, {text:"回头", next:"street2"} ] },
      //   north_sneak: { text: "你踩到碎石发出响声，一名士兵转头。", choices: [ {text:"藏身墙角", next:"north_hide"}, {text:"冲过去", next:"ending_caught1"} ] },
      //   north_hide: { text: "你屏住呼吸，士兵没有发现你。", choices: [ {text:"沿小巷前进", next:"north_escape"}, {text:"返回", next:"street2"} ] },
      //   north_escape: { text: "小巷通向一条河沟，可能通向城外。", choices: [ {text:"顺河沟走", next:"ending_escape_river"}, {text:"返回", next:"street2"} ] },
      //   shelter_wait: { text: "一位老人咳嗽不停，你要帮他吗？", choices: [ {text:"递水", next:"help_old"}, {text:"无视", next:"ignore_old"} ] },
      //   help_old: { text: "老人感激地告诉你西门有秘密通道。", choices: [ {text:"去西门", next:"west1"}, {text:"留下", next:"shelter_stay"} ] },
      //   ignore_old: { text: "轰炸声逼近，防空洞震动。", choices: [ {text:"继续待下去", next:"shelter_shake"}, {text:"逃出", next:"street1"} ] },
      //   shelter_shake: { text: "防空洞入口塌陷。你要挖出口吗？", choices: [ {text:"尝试挖出口", next:"dig_exit"}, {text:"等待救援", next:"ending_dead1"} ] },
      //   shelter_stay: { text: "空气愈加稀薄。", choices: [ {text:"尝试挖出口", next:"dig_exit"}, {text:"等待救援", next:"ending2"} ] },
      //   dig_exit: { text: "你找到裂缝通向外面。", choices: [ {text:"去河边", next:"river1"}, {text:"去西门", next:"west1"} ] },

      //   // 街道与巡逻分支
      //   street1: { text: "街上有日军巡逻，你要怎么做？", choices: [ {text:"躲藏", next:"hide1"}, {text:"假装镇定走过", next:"pass1"}, {text:"沿小路绕行", next:"street3"} ] },
      //   street3: { text: "小路杂草丛生，你踩到铁罐发出声响。", choices: [ {text:"躲在草丛", next:"hide_grass"}, {text:"快速离开", next:"street2"} ] },
      //   hide_grass: { text: "士兵巡逻过来，几乎踩到你。你准备怎么办？", choices: [ {text:"屏住呼吸", next:"hide_grass2"}, {text:"投掷石头引开", next:"hide_grass_stone"} ] },
      //   hide_grass2: { text: "士兵停顿片刻然后离开，你出了一身冷汗。", choices: [ {text:"继续前行", next:"street2"}, {text:"等更久再走", next:"street2_wait"} ] },
      //   hide_grass_stone: { text: "石头吸引了士兵的注意力，他们走向另一边。", choices: [ {text:"趁机离开", next:"street2"}, {text:"再等一会儿", next:"street2_wait"} ] },
      //   street2_wait: { text: "你又等了几分钟，夜色更深，街道更安静。", choices: [ {text:"继续走向三岔口", next:"street2"}, {text:"回头", next:"street1"} ] },

      //   pass1: { text: "日军对你投来怀疑的目光，你要怎么办？", choices: [ {text:"加快脚步", next:"pass2"}, {text:"走进小巷", next:"street2"} ] },
      //   pass2: { text: "你加快了脚步，士兵大声喝令你停下。", choices: [ {text:"解释自己是百姓", next:"pass_explain"}, {text:"继续跑", next:"ending_caught1"} ] },
      //   pass_explain: { text: "士兵狐疑地打量你。", choices: [ {text:"低头赔笑", next:"street2"}, {text:"掏钱贿赂", next:"pass_bribe"} ] },
      //   pass_bribe: { text: "你递出一些钱币，士兵将你赶走。", choices: [ {text:"赶快离开", next:"street2"} ] },

      //   hide1: { text: "你躲进废墟，一名小孩哭了。你帮他吗？", choices: [ {text:"安抚小孩", next:"help_child"}, {text:"离开", next:"leave_child"} ] },
      //   help_child: { text: "小孩告诉你教堂安全，还给了你一块干面包。", choices: [ {text:"去教堂", next:"church"}, {text:"继续前行", next:"street2"} ] },
      //   leave_child: { text: "你甩开小孩，继续走。前面有士兵拦路。", choices: [ {text:"绕路", next:"street2"}, {text:"硬闯", next:"ending_caught1"} ] },
      //   street2: { text: "前面分三条路：东门、西门、河边。", choices: [ {text:"去东门", next:"east1"}, {text:"去西门", next:"west1"}, {text:"去河边", next:"river1"} ] },

      //   // 东门与西门
      //   east1: { text: "东门被封锁。守卫要通行证。", choices: [ {text:"尝试贿赂", next:"bribe1"}, {text:"寻找别路", next:"street2"} ] },
      //   bribe1: { text: "你拿出钱，守卫犹豫不决。", choices: [ {text:"再给多点", next:"ending_escape_east"}, {text:"换条路走", next:"street2"} ] },
      //   west1: { text: "西门有秘密通道，但有匪徒。", choices: [ {text:"与匪徒谈判", next:"bandit1"}, {text:"寻找其他路", next:"street2"} ] },
      //   bandit1: { text: "匪徒要求交换物资。", choices: [ {text:"交出手表", next:"ending_escape_west"}, {text:"拒绝", next:"fight_bandit"} ] },
      //   fight_bandit: { text: "你试图打斗但受伤。", choices: [ {text:"逃跑", next:"street2"}, {text:"求饶", next:"ending_caught_bandit"} ] },

      //   // 河边分支
      //   river1: { text: "河边有小船，但需要撑过去。你要尝试吗？", choices: [ {text:"直接划船", next:"river_row"}, {text:"返回", next:"street2"}, {text:"等夜晚", next:"river_night"} ] },
      //   river_row: { text: "你推船入水，水流湍急。是否继续？", choices: [ {text:"坚持划过去", next:"ending_escape_river"}, {text:"靠岸返回", next:"street2"} ] },
      //   river_night: { text: "夜晚河面起雾，视线很差。你看到一个黑影漂浮在水上。", choices: [ {text:"探查黑影", next:"river_shadow"}, {text:"绕开继续划", next:"ending_escape_river"} ] },
      //   river_shadow: { text: "那是一具尸体，手里还抓着一个包裹。要拿吗？", choices: [ {text:"取包裹", next:"river_package"}, {text:"不拿", next:"ending_escape_river"} ] },
      //   river_package: { text: "包裹里有些钱和一张地图，你带着它继续划船。", choices: [ {text:"利用地图找出口", next:"ending_escape_river"} ] },

      //   // 教堂分支
      //   church: { text: "教堂里有修女和难民。修女邀请你帮忙。", choices: [ {text:"帮忙", next:"church_help"}, {text:"离开", next:"street1"}, {text:"询问消息", next:"church_info"} ] },
      //   church_info: { text: "一名神父悄声告诉你：南门可能守备较松。", choices: [ {text:"去南门", next:"south1"}, {text:"留在教堂", next:"church_help"} ] },
      //   south1: { text: "南门附近有军犬巡逻。", choices: [ {text:"绕过军犬", next:"ending_escape_south"}, {text:"返回", next:"street2"} ] },
      //   church_help: { text: "你帮忙分发食物。有人问你要不要加入抵抗。", choices: [ {text:"加入", next:"resist1"}, {text:"拒绝", next:"church_stay"} ] },
      //   resist1: { text: "你加入了抵抗组织，是否行动？", choices: [ {text:"去救人", next:"rescue1"}, {text:"去收集情报", next:"intel1"} ] },
      //   rescue1: { text: "你救了几位市民，安全撤回。", choices: [ {text:"返回教堂", next:"church_stay"}, {text:"继续行动", next:"rescue2"} ] },
      //   rescue2: { text: "你再次出击，但遇到日军。", choices: [ {text:"交火", next:"ending_rescue_fail"}, {text:"撤退", next:"church_stay"} ] },
      //   intel1: { text: "你潜入敌方阵地获取情报。", choices: [ {text:"成功带回", next:"ending_resist_win"}, {text:"被发现", next:"ending_resist_fail"} ] },
      //   church_stay: { text: "你留在教堂，暂时安全，但外界愈发危险。", choices: [ {text:"继续帮忙", next:"ending_safe"}, {text:"冒险离开", next:"street1"} ] },

      //   // 家中分支
      //   home: { text: "你躲在家里。外面越来越危险。", choices: [ {text:"继续等待", next:"ending1"}, {text:"出去看看", next:"street1"}, {text:"爬上屋顶观察", next:"home_roof"} ] },
      //   home_roof: { text: "你看到南边有火光，北边有巡逻士兵。", choices: [ {text:"去南边", next:"south1"}, {text:"去北边", next:"north1"} ] },

      //   // 结局
      //   ending1: { text: "系统：你留在家中，被日军抓走集体枪毙（市民结局1）", choices: [] },
      //   ending2: { text: "系统：防空洞塌陷，你被埋在废墟（市民结局2）", choices: [] },
      //   ending3: { text: "系统：你搭上小船，逃出了南京（市民结局3）", choices: [] },
      //   ending_caught1: { text: "系统：你被士兵抓住（市民结局4）", choices: [] },
      //   ending_dead1: { text: "系统：你在塌陷中丧生（市民结局5）", choices: [] },
      //   ending_escape_east: { text: "系统：你用钱贿赂守卫，逃出东门（市民结局6）", choices: [] },
      //   ending_escape_west: { text: "系统：你通过西门秘密通道逃脱（市民结局7）", choices: [] },
      //   ending_caught_bandit: { text: "系统：你被匪徒劫杀（市民结局8）", choices: [] },
      //   ending_escape_river: { text: "系统：你顺利划船逃脱（市民结局9）", choices: [] },
      //   ending_escape_south: { text: "系统：你趁夜绕过军犬，从南门逃出（市民结局10）", choices: [] },
      //   ending_rescue_fail: { text: "系统：你在救援行动中牺牲（市民结局11）", choices: [] },
      //   ending_resist_win: { text: "系统：你的情报使抵抗获得胜利（市民结局12）", choices: [] },
      //   ending_resist_fail: { text: "系统：你被敌军发现并捕获（市民结局13）", choices: [] },
      //   ending_safe: { text: "系统：你留在教堂避难，侥幸生存（市民结局14）", choices: [] }

       },
      难民: {
        start: { text: "你背着行李和家人穿过混乱的街道，一名陌生难民拉住你：‘一起走吗？’", choices: [ {text:"和他结伴", next:"ally1"}, {text:"拒绝同行", next:"alone1"}, {text:"观察他的意图", next:"check_ally"} ] },
        check_ally: { text: "他看起来十分焦急，还带着一个小女孩。", choices: [ {text:"决定结伴", next:"ally1"}, {text:"还是拒绝", next:"alone1"} ] },

        ally1: { text: "你们结伴而行，他告诉你南边有个安全的仓库。", choices: [ {text:"去仓库", next:"warehouse1"}, {text:"先去找水", next:"water1"}, {text:"找食物", next:"food_search1"} ] },
        food_search1: { text: "你们在街边翻找破损的商店。", choices: [ {text:"进入杂货店", next:"shop1"}, {text:"去面包房", next:"bakery1"} ] },
        shop1: { text: "杂货店里有一些罐头和米袋。", choices: [ {text:"拿走罐头", next:"warehouse1"}, {text:"拿米袋", next:"warehouse1"}, {text:"全拿", next:"warehouse_suspect"} ] },
        bakery1: { text: "面包房里剩下几块发霉的面包。", choices: [ {text:"清理霉斑后吃", next:"warehouse1"}, {text:"扔掉", next:"warehouse1"} ] },
        warehouse_suspect: { text: "你们搬着大量物资离开，引起了旁人注意。", choices: [ {text:"分一些给别人", next:"warehouse1"}, {text:"快速离开", next:"warehouse1"} ] },

        water1: { text: "你们找到一口井，但井旁有日军哨兵。", choices: [ {text:"偷偷取水", next:"water_sneak"}, {text:"放弃", next:"warehouse1"} ] },
        water_sneak: { text: "你悄悄打水，哨兵似乎听到了声音。", choices: [ {text:"装作乞丐", next:"water_beg"}, {text:"迅速离开", next:"warehouse1"} ] },
        water_beg: { text: "哨兵用枪驱赶你，你低声求饶后逃走。", choices: [ {text:"返回仓库", next:"warehouse1"} ] },

        warehouse1: { text: "仓库里聚集了许多难民，他们在商议逃生路线。", choices: [ {text:"跟随大队走", next:"team1"}, {text:"单独探索", next:"alone1"}, {text:"向人打听情报", next:"warehouse_info"} ] },
        warehouse_info: { text: "有人低声说西门有一条未封死的下水道。", choices: [ {text:"去查看", next:"sewer1"}, {text:"不相信", next:"team1"} ] },
        sewer1: { text: "下水道口臭气熏天，但也许能通到城外。", choices: [ {text:"进入", next:"sewer_inside1"}, {text:"放弃", next:"warehouse1"} ] },
        sewer_inside1: { text: "你在黑暗的管道里摸索前行，前方传来奇怪的声响。", choices: [ {text:"靠近查看", next:"sewer_rat"}, {text:"原路返回", next:"warehouse1"} ] },
        sewer_rat: { text: "一群老鼠吓得你差点摔倒。", choices: [ {text:"继续前进", next:"ending_refugee_sewer"}, {text:"退出", next:"warehouse1"} ] },

        team1: { text: "大队计划夜里从西门突围。", choices: [ {text:"参与突围", next:"west_escape"}, {text:"改去东门", next:"east_escape_plan"} ] },
        west_escape: { text: "夜里你们出发，西门有日军放哨。", choices: [ {text:"掩护大家", next:"fight_guard"}, {text:"悄悄绕过", next:"ending_refugee_west"}, {text:"等人分散后再走", next:"west_wait"} ] },
        west_wait: { text: "你决定等一会儿，巡逻似乎减少。", choices: [ {text:"趁机离开", next:"ending_refugee_west"}, {text:"跟随大队", next:"fight_guard"} ] },
        fight_guard: { text: "你扔出石块吸引注意，自己中枪倒地。", choices: [ {text:"坚持爬走", next:"ending_refugee_wounded"}, {text:"被抓", next:"ending_refugee_caught"} ] },

        east_escape_plan: { text: "你独自去东门探路，发现关卡紧闭。", choices: [ {text:"尝试贿赂", next:"refugee_bribe"}, {text:"返回仓库", next:"warehouse1"} ] },
        refugee_bribe: { text: "你拿出仅有的钱币。", choices: [ {text:"全部给出", next:"ending_refugee_east"}, {text:"留一半", next:"ending_refugee_fail"} ] },

        alone1: { text: "你拒绝了同伴，自己沿街前进，遇到一对母子。", choices: [ {text:"帮助他们", next:"help_mother"}, {text:"无视离开", next:"street_refugee1"} ] },
        help_mother: { text: "母亲请求你带她孩子去安全地。", choices: [ {text:"答应", next:"child_carry"}, {text:"拒绝", next:"street_refugee1"} ] },
        child_carry: { text: "你背起孩子，他告诉你北边有修道院。", choices: [ {text:"去修道院", next:"monastery1"}, {text:"继续寻找出路", next:"street_refugee1"} ] },

        street_refugee1: { text: "街道上有士兵搜查。", choices: [ {text:"躲藏", next:"hide_refugee1"}, {text:"假装镇定", next:"pass_refugee1"} ] },
        hide_refugee1: { text: "你钻进残破的车厢。士兵从旁经过。", choices: [ {text:"继续等待", next:"street_refugee2"}, {text:"趁机离开", next:"street_refugee2"} ] },
        pass_refugee1: { text: "士兵对你投来疑惑的目光。", choices: [ {text:"递上口粮贿赂", next:"ending_refugee_safe"}, {text:"低头快走", next:"street_refugee2"} ] },
        street_refugee2: { text: "你来到三岔路：东门、西门、河边。", choices: [ {text:"去东门", next:"east_escape_plan"}, {text:"去西门", next:"west_escape"}, {text:"去河边", next:"refugee_river"} ] },

        refugee_river: { text: "河边有难民在争抢一条小船。", choices: [ {text:"加入争抢", next:"refugee_fight"}, {text:"寻找别船", next:"refugee_boat_search"}, {text:"等待机会", next:"river_wait"} ] },
        river_wait: { text: "你等到夜晚，河面起雾，争抢的人散去。", choices: [ {text:"悄悄划走", next:"ending_refugee_boat_escape"}, {text:"放弃", next:"street_refugee2"} ] },
        refugee_fight: { text: "争抢中有人掉入水里。", choices: [ {text:"救人", next:"refugee_rescue"}, {text:"抢船", next:"ending_refugee_boat_escape"} ] },
        refugee_rescue: { text: "你被他按在水里无法喘息。", choices: [ {text:"坚持救人", next:"ending_refugee_fight_escape"}, {text:"逃生上岸", next:"ending_refugee_boat2_escape"} ] },
        refugee_boat_search: { text: "你找到一只破旧的小艇。", choices: [ {text:"冒险乘坐", next:"ending_refugee_boat_escape"}, {text:"放弃", next:"street_refugee2"} ] },

        monastery1: { text: "修道院里有少量食物和药品。", choices: [ {text:"休息一晚", next:"monastery_rest"}, {text:"问路", next:"monastery_info"} ] },
        monastery_rest: { text: "夜里传来枪声，修女催促大家离开。", choices: [ {text:"跟随修女", next:"ending_refugee_safe"}, {text:"自己寻找出路", next:"street_refugee2"} ] },
        monastery_info: { text: "修女告诉你南边河口较安全。", choices: [ {text:"前往河口", next:"refugee_river"} ] },

        // 结局
        ending_refugee_west: { text: "系统：你跟随大队突围时被射杀（难民结局1）", choices: [] },
        ending_refugee_wounded: { text: "系统：你被士兵用刺刀刺入胸膛（难民结局2）", choices: [] },
        ending_refugee_caught: { text: "系统：你被士兵用军刀砍头（难民结局3）", choices: [] },
        ending_refugee_east: { text: "系统：你被一刀砍死（难民结局4）", choices: [] },
        ending_refugee_fail: { text: "系统：你被刺刀多次刺死（难民结局5）", choices: [] },
        ending_refugee_safe: { text: "系统：你被一刀刺入胸膛（难民结局6）", choices: [] },
        ending_refugee_fight_escape: { text: "系统：你呛水过多被淹死（难民结局7）", choices: [] },
        ending_refugee_boat_escape: { text: "系统：你逃亡过程中船漏水了，你被淹死了（难民结局8）", choices: [] },
        ending_refugee_boat2_escape: { text: "系统：你没有抢到船，待在岸边被日军射杀（难民结局9）", choices: [] },
        ending_refugee_sewer: { text: "系统：你在下水道被淹死（难民结局10）", choices: [] }
},
      学生: {
        start: { text: "学校早已停课，你和几位同学藏在一栋废弃的教室楼里。有人说城中有安全区。", choices: [ {text:"和同学们商量逃跑", next:"student_meeting"}, {text:"独自行动", next:"student_alone"} ] },
        student_meeting: { text: "大家意见不一，有人想去教堂，有人想去河边。", choices: [ {text:"投票决定", next:"student_vote"}, {text:"听从班长意见", next:"student_leader"} ] },
        student_vote: { text: "投票结果：多数人想去教堂避难。", choices: [ {text:"跟随大家去教堂", next:"student_church"}, {text:"自己改去河边", next:"student_river"} ] },
        student_leader: { text: "班长建议大家分组行动，减少风险。", choices: [ {text:"和班长一组", next:"student_team_leader"}, {text:"和好朋友一组", next:"student_friend"} ] },
        student_team_leader: { text: "班长带你们绕小路前往教堂。途中遇到士兵搜查。", choices: [ {text:"藏进草丛", next:"student_hide"}, {text:"假装镇定", next:"student_check"} ] },
        student_friend: { text: "你和朋友沿另一条路走，发现一辆废弃的马车。", choices: [ {text:"爬上车躲藏", next:"student_cart"}, {text:"绕路前进", next:"student_river"} ] },
        student_hide: { text: "你们屏住呼吸，士兵未发现你们。", choices: [ {text:"继续前往教堂", next:"student_church"} ] },
        student_check: { text: "士兵盘问你们的身份。", choices: [ {text:"说自己是学生", next:"student_safe"}, {text:"撒谎说是乞丐", next:"student_trouble"} ] },
        student_safe: { text: "士兵冷笑后要搜身。", choices: [ {text:"举起双手", next:"student_check_end"} ] },
        student_trouble: { text: "士兵怀疑你们，要求搜身。", choices: [ {text:"配合搜查", next:"student_check_end"}, {text:"试图逃跑", next:"ending_student_caught"} ] },
        student_check_end: { text: "你被搜出学生证，士兵不再为难。", choices: [ {text:"前往教堂", next:"student_church"} ] },
        student_church: { text: "教堂内有修女接待你们，她需要人手帮忙分发食物。", choices: [ {text:"留下帮忙", next:"student_help"}, {text:"询问逃生路线", next:"student_info"} ] },
        student_help: { text: "你们帮忙搬运食物，赢得修女信任。", choices: [ {text:"跟随修女去安全区", next:"ending_student_safe"}, {text:"再探索其他路线", next:"student_river"} ] },
        student_info: { text: "修女告诉你河边可能有船只。", choices: [ {text:"前往河边", next:"student_river"} ] },
        student_river: { text: "河边有几条小船，但有巡逻士兵。", choices: [ {text:"等夜里行动", next:"student_river_night"}, {text:"尝试强行划船", next:"ending_student_danger"} ] },
        student_river_night: { text: "夜幕降临，你悄悄靠近小船。", choices: [ {text:"划船离开", next:"ending_student_river_escape"}, {text:"改变主意", next:"student_church"} ] },
        student_cart: { text: "你躲在马车里，听到士兵的脚步声逼近。", choices: [ {text:"屏住呼吸", next:"student_safe_cart"}, {text:"跳下逃跑", next:"ending_student_caught"} ] },
        student_safe_cart: { text: "士兵走过，你成功逃过一劫。", choices: [ {text:"前往河边", next:"student_river"} ] },
        student_alone: { text: "你决定独自行动，路过学校图书馆时，看到有书籍散落。", choices: [ {text:"拿一本日记", next:"student_journal"}, {text:"不理会", next:"student_alone2"} ] },
        student_journal: { text: "日记里记载了秘密通道的线索。", choices: [ {text:"按线索行动", next:"student_secret_path"}, {text:"尝试去河边", next:"student_river"} ] },
        student_alone2: { text: "你走出学校，考虑应该去哪里。", choices: [ {text:"去教堂", next:"student_church"}, , {text:"想办法出城", next:"ending_student_river_escape"},{text:"去河边", next:"student_river"} ] },
        student_secret_path: { text: "你沿着线索找到一条隐蔽的小巷。", choices: [ {text:"继续前进", next:"ending_student_secret_escape"}, {text:"犹豫返回", next:"student_church"} ] },

        ending_student_safe: { text: "系统：你留在教堂，最终被日军坑杀（学生结局1）", choices: [] },
        ending_student_caught: { text: "系统：你被士兵开枪射杀（学生结局2）", choices: [] },
        ending_student_danger: { text: "系统：你试图划船被巡逻发现并射杀（学生结局3）", choices: [] },
        ending_student_river_escape: { text: "系统：你被士兵发现并射杀（学生结局4）", choices: [] },
        ending_student_secret_escape: { text: "系统：你逃出城外被日军射杀（学生结局5）", choices: [] }
},
      教师: {
        start: { text: "你是一名教师，学校已经解散，学生们四散而逃。你独自回到空荡荡的教室。", choices: [ {text:"寻找学生", next:"teacher_search"}, {text:"收集物资", next:"teacher_collect"}, {text:"去教堂", next:"teacher_church_start"} ] },

        teacher_search: { text: "你想起有几名学生可能还躲在图书馆。", choices: [ {text:"前往图书馆", next:"teacher_library"}, {text:"放弃寻找", next:"teacher_collect"} ] },
        teacher_library: { text: "图书馆一片狼藉，你听到二楼传来低声呼喊。", choices: [ {text:"上楼查看", next:"teacher_rescue"}, {text:"不理会", next:"teacher_collect"} ] },
        teacher_rescue: { text: "你找到两名学生，他们哭着请求你带他们离开。", choices: [ {text:"带上学生", next:"teacher_with_students"}, {text:"拒绝", next:"teacher_collect"} ] },
        teacher_with_students: { text: "你带着两名学生，准备寻找安全的路线。", choices: [ {text:"去教堂", next:"teacher_church_start"}, {text:"去河边", next:"teacher_river"} ] },

        teacher_collect: { text: "你在办公室找到一些粉笔和几本书。书中夹着一张城门守卫的排班表。", choices: [ {text:"利用排班表找路线", next:"teacher_gate_plan"}, {text:"前往教堂", next:"teacher_church_start"} ] },
        teacher_gate_plan: { text: "排班表显示西门夜间守卫较少。", choices: [ {text:"准备去西门", next:"teacher_west"}, {text:"改去教堂", next:"teacher_church_start"} ] },

        teacher_church_start: { text: "教堂内有修女接待你，她需要人帮忙照顾伤员。", choices: [ {text:"留下帮忙", next:"teacher_help"}, {text:"询问逃生路线", next:"teacher_church_info"} ] },
        teacher_help: { text: "你忙了一整天，修女对你表示感谢。", choices: [ {text:"跟随修女去安全区", next:"ending_teacher_safe"}, {text:"转去找其他出路", next:"teacher_river"} ] },
        teacher_church_info: { text: "修女告诉你西门和河边都有可能逃生。", choices: [ {text:"去西门", next:"teacher_west"}, {text:"去河边", next:"teacher_river"} ] },

        teacher_west: { text: "西门有少量士兵巡逻。", choices: [ {text:"偷偷观察", next:"teacher_west_hide"}, {text:"尝试混过去", next:"teacher_west_pass"} ] },
        teacher_west_hide: { text: "你看到一辆马车经过，可能可用作掩护。", choices: [ {text:"跟随马车", next:"ending_teacher_west_escape"}, {text:"另寻出路", next:"teacher_river"} ] },
        teacher_west_pass: { text: "士兵盘问你。", choices: [ {text:"声称自己是教师", next:"teacher_pass_teach"}, {text:"贿赂士兵", next:"teacher_bribe"} ] },
        teacher_pass_teach: { text: "士兵冷哼用枪指着你。", choices: [ {text:"举起双手", next:"ending_teacher_west_escape"} , {text:"贿赂士兵", next:"teacher_bribe"} ] },
        teacher_bribe: { text: "你掏出钱包，企图递给士兵一些钱。", choices: [ {text:"向前塞钱", next:"ending_teacher_west_escape"} ] },

        teacher_river: { text: "河边有几条小船，一些市民正在准备离开。", choices: [ {text:"加入他们", next:"teacher_river_join"}, {text:"自己找船", next:"teacher_river_search"} ] },
        teacher_river_join: { text: "你与其他人一起推船下水。", choices: [ {text:"一起划走", next:"ending_teacher_river_escape"}, {text:"放弃", next:"teacher_church_start"} ] },
        teacher_river_search: { text: "你找到一条破旧的小艇。", choices: [ {text:"修好小艇", next:"teacher_river_fix"}, {text:"寻找更好的船", next:"teacher_river_danger"} ] },
        teacher_river_fix: { text: "你用木板修好小艇并离开。", choices: [ {text:"顺利离开", next:"ending_teacher_river_escape"} ] },
        teacher_river_danger: { text: "在寻找时你被巡逻士兵发现。", choices: [ {text:"逃跑", next:"teacher_river_escape_attempt"}, {text:"反抗", next:"ending_teacher_caught"} ] },
        teacher_river_escape_attempt: { text: "你躲在芦苇丛中，士兵最终离开。", choices: [ {text:"回到小艇", next:"ending_teacher_river_escape"} ] },

        ending_teacher_safe: { text: "系统：你留在教堂，最后被日军坑杀（教师结局1）", choices: [] },
        ending_teacher_west_escape: { text: "系统：你被士兵当场射杀（教师结局2）", choices: [] },
        ending_teacher_river_escape: { text: "系统：你顺利划船进入长江，不幸翻船被淹死（教师结局3）", choices: [] },
        ending_teacher_caught: { text: "系统：你被士兵当场击毙（教师结局4）", choices: [] }
},
医生: {
        start: { text: "你是一名医生，城市陷入混乱，你所在的小诊所药品不足。外面有人敲门求助。", choices: [ {text:"开门看看", next:"doctor_open"}, {text:"无视敲门", next:"doctor_ignore"}, {text:"收集药品", next:"doctor_collect"} ] },

        doctor_open: { text: "门外是一名受伤的青年，流着血请求治疗。", choices: [ {text:"给他包扎", next:"doctor_bandage"}, {text:"拒绝", next:"doctor_ignore"} ] },
        doctor_bandage: { text: "你用仅有的纱布为他处理伤口，他告诉你教堂有安全庇护。", choices: [ {text:"去教堂", next:"doctor_church"}, {text:"继续留在诊所", next:"doctor_collect"} ] },

        doctor_ignore: { text: "你没有开门，青年失望地离开。外面传来枪声。", choices: [ {text:"小心探头看看", next:"doctor_peek"}, {text:"继续整理物资", next:"doctor_collect"} ] },
        doctor_peek: { text: "你看到士兵正在街头搜查。", choices: [ {text:"躲回诊所", next:"doctor_collect"}, {text:"从后门离开", next:"doctor_backdoor"} ] },
        doctor_backdoor: { text: "后门通向一条小巷。", choices: [ {text:"走向教堂", next:"doctor_church"}, {text:"朝河边走", next:"doctor_river"} ] },

        doctor_collect: { text: "你在诊所里找到一些药品和绷带，还发现了一把小刀。", choices: [ {text:"带上药品", next:"doctor_plan"}, {text:"原地等待", next:"ending_doctor_caught"} ] },
        doctor_plan: { text: "你决定利用这些药品换取安全。", choices: [ {text:"去教堂", next:"doctor_church"}, {text:"去西门试试贿赂", next:"doctor_west"} ] },

        doctor_church: { text: "教堂内有大量伤员，修女请求你帮忙救治。", choices: [ {text:"留下帮忙", next:"doctor_help"}, {text:"不想留下", next:"doctor_river"} ] },
        doctor_help: { text: "你为伤员包扎，赢得大家信任。", choices: [ {text:"跟随修女前往安全区", next:"ending_doctor_safe"}, {text:"寻找别的出路", next:"doctor_river"} ] },

        doctor_west: { text: "西门守卫森严，一名士兵发现了你。", choices: [ {text:"用药品贿赂", next:"doctor_bribe"}, {text:"假装路过", next:"ending_doctor_caught"} ] },
        doctor_bribe: { text: "你递出药品，士兵收下后放行。", choices: [ {text:"离开", next:"ending_doctor_west_escape"} ] },

        doctor_river: { text: "河边有伤者需要急救，他家人求你帮忙。", choices: [ {text:"救治他", next:"doctor_river_help"}, {text:"无视离开", next:"doctor_river_boat"} ] },
        doctor_river_help: { text: "你救治了伤者，他们感谢地让出一条小船。", choices: [ {text:"乘船逃离", next:"ending_doctor_river_escape"}, {text:"返回教堂", next:"doctor_church"} ] },
        doctor_river_boat: { text: "你找到一条空船。", choices: [ {text:"划船离开", next:"ending_doctor_river_escape"}, {text:"返回", next:"doctor_church"} ] },

        ending_doctor_safe: { text: "系统：你留在教堂救人，最后被日军坑杀（医生结局1）", choices: [] },
        ending_doctor_west_escape: { text: "系统：药品被扔在地上，你被射杀（医生结局2）", choices: [] },
        ending_doctor_river_escape: { text: "系统：逃跑途中翻船了，你被淹死了（医生结局3）", choices: [] },
        ending_doctor_caught: { text: "系统：你被巡逻士兵抓住并射杀（医生结局4）", choices: [] }
},
商人: {
        start: { text: "你是一名商人，战争让你的商铺变得破败。你需要决定是保住财富还是活命。", choices: [ {text:"收集剩余货物", next:"merchant_collect"}, {text:"带上金银逃跑", next:"merchant_escape_plan"}, {text:"去教堂避难", next:"merchant_church"} ] },

        merchant_collect: { text: "你翻找商铺，发现一些布匹和罐头。", choices: [ {text:"带上布匹", next:"merchant_market"}, {text:"带上罐头", next:"merchant_market"} ] },
        merchant_market: { text: "你准备去黑市换取情报。", choices: [ {text:"去黑市", next:"merchant_blackmarket"}, {text:"改去河边", next:"merchant_river"} ] },
        merchant_blackmarket: { text: "黑市上有一群陌生人，他们对你的货物虎视眈眈。", choices: [ {text:"用货物换情报", next:"merchant_info"}, {text:"拒绝交易", next:"merchant_danger"} ] },
        merchant_info: { text: "你换得一张西门守军贿赂名单。", choices: [ {text:"去西门", next:"merchant_west"}, {text:"回家藏货", next:"merchant_hide"} ] },
        merchant_danger: { text: "他们试图抢劫你。", choices: [ {text:"交出货物", next:"merchant_info"}, {text:"反抗", next:"ending_merchant_dead"} ] },
        merchant_hide: { text: "你带着货物回到家，但街上越来越危险。", choices: [ {text:"继续躲藏", next:"ending_merchant_caught"}, {text:"换条路走", next:"merchant_river"} ] },

        merchant_escape_plan: { text: "你拿出一些金银首饰，打算用来贿赂士兵。", choices: [ {text:"去东门", next:"merchant_east"}, {text:"去西门", next:"merchant_west"} ] },
        merchant_east: { text: "东门士兵有些松懈。", choices: [ {text:"拿出金银贿赂", next:"ending_merchant_east_escape"}, {text:"改走河边", next:"merchant_river"} ] },
        merchant_west: { text: "西门士兵盘查严格。", choices: [ {text:"贿赂士兵", next:"ending_merchant_west_escape"}, {text:"寻找秘密通道", next:"merchant_secret"} ] },
        merchant_secret: { text: "你跟随线人发现一条小巷。", choices: [ {text:"跟随线人进入", next:"ending_merchant_secret_escape"}, {text:"独自寻找其他路线", next:"ending_merchant_dead"} ] },

        merchant_church: { text: "教堂内有许多难民，修女对你随身的珠宝很在意。", choices: [ {text:"捐出一些珠宝", next:"merchant_church_help"}, {text:"拒绝捐赠", next:"merchant_river"} ] },
        merchant_church_help: { text: "修女感谢你，告诉你安全路线。", choices: [ {text:"沿路线逃生", next:"ending_merchant_safe"} ] },

        merchant_river: { text: "河边有船夫正在等待。", choices: [ {text:"用金银买船", next:"ending_merchant_river_escape"}, {text:"寻找偷渡船", next:"merchant_boat_search"} ] },
        merchant_boat_search: { text: "你找到一条破船，必须修理才能用。", choices: [ {text:"修理破船", next:"ending_merchant_river2_escape"}, {text:"放弃", next:"merchant_river"} ] },

        ending_merchant_safe: { text: "系统：你被城外日军砍杀（商人结局1）", choices: [] },
        ending_merchant_east_escape: { text: "系统：你从东门逃出,被日军炸死（商人结局2）", choices: [] },
        ending_merchant_west_escape: { text: "系统：你用金银从西门脱身，遇到日军被射杀（商人结局3）", choices: [] },
        ending_merchant_river_escape: { text: "系统：你在长江被日军飞机扫射致死（商人结局4）", choices: [] },
        ending_merchant_river2_escape: { text: "系统：你修船时被人背后偷袭致死（商人结局5）", choices: [] },
        ending_merchant_secret_escape: { text: "系统：你沿秘密通道离开城市，逃亡途中被飞机炸死（商人结局6）", choices: [] },
        ending_merchant_dead: { text: "系统：你在混乱中被土匪杀害（商人结局7）", choices: [] },
        ending_merchant_caught: { text: "系统：你被日军抓住集体枪毙（商人结局8）", choices: [] }
},
农夫: {
        start: { text: "你是一名农夫，平日里在城郊种地。日军入侵后，你被困在城内。", choices: [ {text:"带上锄头防身", next:"farmer_tool"}, {text:"寻找食物", next:"farmer_food"}, {text:"去找家人", next:"farmer_family"} ] },

        farmer_tool: { text: "你拿起锄头，打算寻找出路。", choices: [ {text:"走向城东", next:"farmer_east"}, {text:"去西门", next:"farmer_west"} ] },
        farmer_food: { text: "你在市场废墟里找到一些粮食。", choices: [ {text:"带上粮食", next:"farmer_hide"}, {text:"分给其他难民", next:"farmer_reputation"} ] },
        farmer_family: { text: "你想到家人可能躲在教堂附近。", choices: [ {text:"去教堂", next:"farmer_church"}, {text:"去河边找", next:"farmer_river"} ] },

        farmer_hide: { text: "你在一间破房子里休息。", choices: [ {text:"继续休息", next:"ending_farmer_caught"}, {text:"出去找出路", next:"farmer_west"} ] },
        farmer_reputation: { text: "难民感激你，告诉你一条秘密小路。", choices: [ {text:"沿小路走", next:"ending_farmer_secret"}, {text:"不相信", next:"farmer_west"} ] },

        farmer_east: { text: "东门守卫严密。", choices: [ {text:"尝试贿赂", next:"farmer_bribe"}, {text:"寻找其他路", next:"farmer_west"} ] },
        farmer_bribe: { text: "你拿出仅有的铜钱。", choices: [ {text:"全部给出", next:"ending_farmer_east_escape"}, {text:"放弃", next:"farmer_west"} ] },

        farmer_west: { text: "西门周围有几名士兵巡逻。", choices: [ {text:"躲在车后", next:"farmer_hide_west"}, {text:"试着混过去", next:"ending_farmer_caught"} ] },
        farmer_hide_west: { text: "你趁士兵不注意从旁边的小道溜出去。", choices: [ {text:"成功逃出", next:"ending_farmer_west_escape"} ] },

        farmer_church: { text: "教堂里有修女安抚难民，她问你是否愿意帮忙耕地换食物。", choices: [ {text:"答应", next:"farmer_help_church"}, {text:"拒绝", next:"farmer_river"} ] },
        farmer_help_church: { text: "你在教堂花园种下蔬菜，获得修女信任。", choices: [ {text:"跟随修女逃生", next:"ending_farmer_safe"}, {text:"自己找路", next:"farmer_river"} ] },

        farmer_river: { text: "河边有村民正在修船。", choices: [ {text:"帮忙修船", next:"farmer_boat"}, {text:"自己找船", next:"farmer_find_boat"} ] },
        farmer_boat: { text: "你帮忙修好船，获得上船资格。", choices: [ {text:"随船离开", next:"ending_farmer_river_escape"} ] },
        farmer_find_boat: { text: "你找到一条小木船。", choices: [ {text:"独自划走", next:"ending_farmer_river_escape"}, {text:"放弃", next:"farmer_west"} ] },

        ending_farmer_safe: { text: "系统：你留在教堂，被日军坑杀（农夫结局1）", choices: [] },
        ending_farmer_secret: { text: "系统：你沿秘密小路逃出，被城外日军射杀（农夫结局2）", choices: [] },
        ending_farmer_east_escape: { text: "系统：你贿赂士兵从东门逃出，被城外日军射杀（农夫结局3）", choices: [] },
        ending_farmer_west_escape: { text: "系统：你从西门小道溜出，被城墙上方士兵射杀（农夫结局4）", choices: [] },
        ending_farmer_river_escape: { text: "系统：你在船上被日军飞机扫射死亡（农夫结局5）", choices: [] },
        ending_farmer_caught: { text: "系统：你被巡逻士兵抓住并射杀（农夫结局6）", choices: [] }
},
地下党员: {
        start: { text: "你是一名潜伏在城内的地下党员，任务是搜集情报并保护平民。", choices: [ {text:"联系组织", next:"agent_contact"}, {text:"独自行动", next:"agent_alone"}, {text:"前往秘密据点", next:"agent_hideout"} ] },

        agent_contact: { text: "你通过暗号与一名信使见面，他交给你一份情报。", choices: [ {text:"藏好情报", next:"agent_hide_info"}, {text:"立即传送情报", next:"agent_risk"} ] },
        agent_hide_info: { text: "你将情报藏在旧书中。晚上有人来敲门。", choices: [ {text:"开门", next:"agent_meet_friend"}, {text:"不开门", next:"agent_wait"} ] },
        agent_meet_friend: { text: "是组织派来的同志，他带你去一个安全屋。", choices: [ {text:"前往安全屋", next:"agent_safehouse"} ] },
        agent_wait: { text: "你选择不开门，第二天有士兵在附近巡逻。", choices: [ {text:"躲在屋内", next:"ending_agent_caught"}, {text:"转移", next:"agent_hideout"} ] },

        agent_risk: { text: "你准备把情报交给教堂的联系人，但路上有士兵。", choices: [ {text:"绕路", next:"agent_church"}, {text:"假装平民", next:"agent_check"} ] },
        agent_check: { text: "士兵盘查你的物品。", choices: [ {text:"将情报藏进衣服", next:"agent_escape"}, {text:"硬闯", next:"ending_agent_caught"} ] },
        agent_escape: { text: "你幸运地躲过盘查，继续赶往教堂。", choices: [ {text:"抵达教堂", next:"agent_church"} ] },

        agent_alone: { text: "你独自走在街道上，发现一名同志被捕。", choices: [ {text:"尝试营救", next:"agent_rescue"}, {text:"暗中跟随", next:"agent_follow"} ] },
        agent_rescue: { text: "你与士兵交火，成功救下同志，但自己受伤。", choices: [ {text:"回安全屋", next:"agent_safehouse"}, {text:"去教堂求助", next:"agent_church"} ] },
        agent_follow: { text: "你跟着士兵来到西门岗哨。", choices: [ {text:"潜入岗哨", next:"agent_infiltrate"}, {text:"返回", next:"agent_hideout"} ] },
        agent_infiltrate: { text: "你潜入岗哨发现了敌军调动计划。", choices: [ {text:"带走计划", next:"ending_agent_win"}, {text:"销毁计划", next:"ending_agent_fail"} ] },

        agent_hideout: { text: "秘密据点里有几位同志在整理情报。", choices: [ {text:"参与整理", next:"agent_plan"}, {text:"前往教堂联络点", next:"agent_church"} ] },
        agent_plan: { text: "大家决定分成两路行动。", choices: [ {text:"你带一份情报去东门", next:"agent_east"}, {text:"去河边", next:"agent_river"} ] },
        agent_east: { text: "东门守卫严密。", choices: [ {text:"贿赂守卫", next:"ending_agent_east_escape"}, {text:"寻找暗道", next:"agent_tunnel"} ] },
        agent_tunnel: { text: "你从暗道离开，避开敌军视线。", choices: [ {text:"进入暗道", next:"ending_agent_secret_escape"} ] },

        agent_river: { text: "河边有士兵守卫渡口。", choices: [ {text:"夜晚行动", next:"agent_river_night"}, {text:"制造混乱", next:"agent_distraction"} ] },
        agent_river_night: { text: "夜晚你顺利潜过河边，利用小船离开。", choices: [ {text:"离开", next:"ending_agent_river_escape"} ] },
        agent_distraction: { text: "你制造噪音引开士兵。", choices: [ {text:"趁机划船逃走", next:"ending_agent_river_escape"}, {text:"撤回据点", next:"agent_hideout"} ] },

        agent_church: { text: "你顺利抵达教堂，此处比较安全。", choices: [ {text:"寻找联系人", next:"agent_safehouse2"}, {text:"躲在此处", next:"ending_agent_caught"} ] },
        agent_safehouse: { text: "安全屋内，同志们正在策划突袭。", choices: [ {text:"加入突袭", next:"ending_agent_action"}, {text:"转移情报", next:"ending_agent_win"} ] },
        agent_safehouse2: { text: "你在伤员中找到联系人，并知道了一个安全屋。", choices: [ {text:"告诉敌人", next:"ending_agent_hanjian"}, {text:"躲在此处", next:"ending_agent_caught"}, {text:"前往寻找", next:"agent_safehouse"} ] },

        ending_agent_win: { text: "系统：你成功将情报送出，组织的行动取得胜利（地下党员结局1）", choices: [] },
        ending_agent_fail: { text: "系统：你销毁了情报，错失良机，自己被日军抓获并砍头（地下党员结局2）", choices: [] },
        ending_agent_river_escape: { text: "系统：你不了解水性，船翻了，你被淹死了（地下党员结局3）", choices: [] },
        ending_agent_east_escape: { text: "系统：你用贿赂逃出东门，全是日军，你被射杀了（地下党员结局4）", choices: [] },
        ending_agent_secret_escape: { text: "系统：你在地下迷路，被困死（地下党员结局5）", choices: [] },
        ending_agent_action: { text: "系统：你在突袭中壮烈牺牲（地下党员结局6）", choices: [] },
        ending_agent_hanjian: { text: "系统：你当了狗汉奸，在睡梦中被勒死（地下党员结局7）", choices: [] },
        ending_agent_caught: { text: "系统：你被日军抓获并砍头（地下党员结局8）", choices: [] }
},
孤儿: {
        start: { text: "你是一个失去家人的孤儿，独自徘徊在被毁的街道上。你必须找到安全的地方。", choices: [ {text:"去废墟找食物", next:"orphan_ruin"}, {text:"寻找教堂庇护", next:"orphan_church"}, {text:"跟随难民队伍", next:"orphan_refugee"} ] },

        orphan_ruin: { text: "你在废墟中翻找，发现一只破旧的木盒。", choices: [ {text:"打开木盒", next:"orphan_box"}, {text:"放弃继续找", next:"orphan_more_search"} ] },
        orphan_box: { text: "木盒里有一块面包和一张手写的地图。", choices: [ {text:"吃掉面包", next:"orphan_map"}, {text:"留着面包", next:"orphan_map"} ] },
        orphan_more_search: { text: "你没找到更多食物，反而惊动了附近的士兵。", choices: [ {text:"躲起来", next:"orphan_hide_ruin"}, {text:"跑走", next:"ending_orphan_caught"} ] },
        orphan_hide_ruin: { text: "你藏在石块后，士兵搜查了一会儿便离开。", choices: [ {text:"拿着地图走", next:"orphan_map"} ] },
        orphan_map: { text: "地图显示河边有一条小路通往城外。", choices: [ {text:"前往河边", next:"orphan_river"}, {text:"先去教堂", next:"orphan_church"} ] },

        orphan_church: { text: "教堂里有修女和难民，她看到你很可怜，递给你一块面包。", choices: [ {text:"留下", next:"orphan_church_stay"}, {text:"感谢后离开", next:"orphan_river"} ] },
        orphan_church_stay: { text: "你在教堂过夜，听到修女说河边有船只。", choices: [ {text:"第二天去河边", next:"orphan_river"}, {text:"继续留在教堂", next:"ending_orphan_safe"} ] },

        orphan_refugee: { text: "你跟在一群难民身后，他们讨论西门是否能逃出去。", choices: [ {text:"跟去西门", next:"orphan_west"}, {text:"离开队伍去河边", next:"orphan_river"} ] },
        orphan_west: { text: "西门守军严密，难民中有人建议贿赂。", choices: [ {text:"凑钱贿赂", next:"ending_orphan_west_escape"}, {text:"放弃改走河边", next:"orphan_river"} ] },

        orphan_river: { text: "河边停着一条小船。你太小无法单独撑船。", choices: [ {text:"等待他人", next:"orphan_wait_boat"}, {text:"尝试自己划", next:"orphan_try_boat"} ] },
        orphan_wait_boat: { text: "一个船夫经过，他问你是否有食物交换。", choices: [ {text:"给他面包", next:"ending_orphan_river_escape"}, {text:"没有食物", next:"orphan_try_boat"} ] },
        orphan_try_boat: { text: "你笨拙地推船下水，但力量不够。", choices: [ {text:"呼喊求助", next:"orphan_boat_help"}, {text:"放弃返回", next:"orphan_church"} ] },
        orphan_boat_help: { text: "一名陌生难民帮你上船。", choices: [ {text:"一起离开", next:"ending_orphan_river_escape"} ] },

        ending_orphan_safe: { text: "系统：你留在教堂，被日军坑杀（孤儿结局1）", choices: [] },
        ending_orphan_west_escape: { text: "系统：你跟随难民贿赂守军，被当场射杀（孤儿结局2）", choices: [] },
        ending_orphan_river_escape: { text: "系统：你搭乘的小船被日军飞机炸沉（孤儿结局3）", choices: [] },
        ending_orphan_caught: { text: "系统：你被士兵抓住并射杀（孤儿结局4）", choices: [] }
},
修女: {
        start: { text: "你是城中教堂的修女，战争让教堂成为了难民的避难所。你需要在保护信众和寻找出路之间做出抉择。", choices: [ {text:"帮助难民", next:"nun_help_refugees"}, {text:"与士兵交涉", next:"nun_negotiate"}, {text:"秘密寻找逃生路线", next:"nun_secret_route"} ] },

        nun_help_refugees: { text: "教堂里挤满了饥饿的难民，你需要分发有限的食物。", choices: [ {text:"平均分配", next:"nun_food_fair"}, {text:"优先照顾儿童", next:"nun_food_children"} ] },
        nun_food_fair: { text: "难民们对你的公平感到感激。", choices: [ {text:"组织祈祷", next:"nun_pray"}, {text:"带领他们逃生", next:"nun_escape_plan"} ] },
        nun_food_children: { text: "一些大人不满你的做法，教堂气氛紧张。", choices: [ {text:"安抚大人", next:"nun_persuade"}, {text:"无视他们", next:"nun_escape_plan"} ] },
        nun_persuade: { text: "你劝说他们团结一致，共同生存。", choices: [ {text:"他们被说服", next:"nun_pray"}, {text:"他们仍然愤怒", next:"nun_escape_plan"} ] },

        nun_pray: { text: "祈祷让大家暂时平静，但外面的炮火越来越近。", choices: [ {text:"准备撤离", next:"nun_escape_plan"}, {text:"继续坚守", next:"ending_nun_church_fall"} ] },
        nun_escape_plan: { text: "你决定带一部分人从教堂后门离开。", choices: [ {text:"走向西门", next:"nun_west"}, {text:"走向河边", next:"nun_river"} ] },

        nun_negotiate: { text: "听闻几名日军士兵走进教堂，你需要保护难民。", choices: [ {text:"与他们谈判", next:"nun_talk"}, {text:"躲避他们", next:"nun_hide"} ] },
        nun_talk: { text: "你走出房间，在院子里面对士兵。", choices: [ {text:"放他们进去", next:"nun_escape_plan"}, {text:"拒绝进入", next:"nun_resist"} ] },
        nun_resist: { text: "你张开双臂阻挡在士兵面前。", choices: [ {text:"不准进来", next:"ending_nun_caught"}, {text:"带领难民反抗", next:"ending_nun_caught2"} ] },
        nun_hide: { text: "你带着孩子们躲在地下室。", choices: [ {text:"等士兵离开", next:"nun_escape_plan"}, {text:"偷偷转移", next:"nun_river"} ] },

        nun_secret_route: { text: "你记得教堂旁的墓地下有一条古老的地道。", choices: [ {text:"进入地道", next:"nun_tunnel"}, {text:"暂时不走", next:"nun_help_refugees"} ] },
        nun_tunnel: { text: "地道昏暗潮湿，你带着几名孩子前行。", choices: [ {text:"继续走", next:"ending_nun_tunnel_escape"}, {text:"返回教堂", next:"nun_help_refugees"} ] },

        nun_west: { text: "西门守卫发现了你们。", choices: [ {text:"请求通行", next:"nun_bribe_west"}, {text:"寻找小路", next:"nun_secret_path"} ] },
        nun_bribe_west: { text: "你用教堂的银十字架换取通行。", choices: [ {text:"通过西门", next:"ending_nun_west_escape"} ] },
        nun_secret_path: { text: "你找到一条小路通向西门外。", choices: [ {text:"偷偷离开", next:"ending_nun_west_escape"} ] },

        nun_river: { text: "河边有一条小船。难民请求你带他们一起走。", choices: [ {text:"同意带他们", next:"ending_nun_river_escape"}, {text:"只带孩子", next:"ending_nun_river_escape"} ] },

        ending_nun_church_fall: { text: "系统：你坚持留在教堂，最终与难民一同被日军坑杀（修女结局1）", choices: [] },
        ending_nun_west_escape: { text: "系统：你离开后遇上日军被凌辱（修女结局2）", choices: [] },
        ending_nun_river_escape: { text: "系统：你乘船被日军飞机炸毁（修女结局3）", choices: [] },
        ending_nun_tunnel_escape: { text: "系统：你带孩子掉入大坑溺亡（修女结局4）", choices: [] },
        ending_nun_caught: { text: "系统：你被士兵抓住并被凌辱（修女结局5）", choices: [] },
        ending_nun_caught2: { text: "系统：你和难民被士兵用机枪全部射杀（修女结局6）", choices: [] }
},
流浪汉: {
        start: { text: "你是城中的流浪汉，平日以捡拾残羹剩饭为生。战火中，你必须找到一条活路。", choices: [ {text:"去废墟找食物", next:"hobo_ruin"}, {text:"前往教堂", next:"hobo_church"}, {text:"沿河边行走", next:"hobo_river"} ] },

        hobo_ruin: { text: "你在废墟中翻找，发现一件破外套和一块干面包。", choices: [ {text:"穿上外套", next:"hobo_hide"}, {text:"拿走面包", next:"hobo_hide"} ] },
        hobo_hide: { text: "夜晚将至，你躲在破墙后。", choices: [ {text:"继续等待", next:"hobo_danger"}, {text:"出去看看", next:"hobo_street"} ] },
        hobo_danger: { text: "夜里有士兵搜查，听到他们的脚步声。", choices: [ {text:"屏住呼吸", next:"hobo_safe_night"}, {text:"逃跑", next:"ending_hobo_caught"} ] },
        hobo_safe_night: { text: "士兵离开了，你活过了这一夜。", choices: [ {text:"第二天去教堂", next:"hobo_church"}, {text:"去河边", next:"hobo_river"} ] },

        hobo_church: { text: "教堂内的修女见到你很可怜，给你一块面包。", choices: [ {text:"留下帮忙", next:"hobo_help"}, {text:"离开教堂", next:"hobo_river"} ] },
        hobo_help: { text: "你帮忙打扫教堂，修女告诉你一条安全路。", choices: [ {text:"沿路逃生", next:"ending_hobo_safe"}, {text:"不离开", next:"ending_hobo_church"} ] },

        hobo_river: { text: "河边有几条船，但看守严密。", choices: [ {text:"偷偷靠近", next:"hobo_boat_attempt"}, {text:"等夜里行动", next:"hobo_river_night"} ] },
        hobo_boat_attempt: { text: "你试图潜入一条船，船夫发现了你。", choices: [ {text:"求他带你走", next:"hobo_beg_boat"}, {text:"跳入河里", next:"ending_hobo_drown"} ] },
        hobo_beg_boat: { text: "船夫看你可怜，让你上船。", choices: [ {text:"顺利离开", next:"ending_hobo_river_escape"} ] },
        hobo_river_night: { text: "夜晚，船只无人看守。", choices: [ {text:"划船离开", next:"ending_hobo_river_escape"}, {text:"犹豫放弃", next:"hobo_church"} ] },

        hobo_street: { text: "街上有士兵巡逻。", choices: [ {text:"躲进小巷", next:"hobo_alley"}, {text:"装作乞丐", next:"hobo_beg_street"} ] },
        hobo_alley: { text: "小巷里有几名匪徒，他们盯上了你。", choices: [ {text:"拿出面包贿赂", next:"hobo_escape_bandit"}, {text:"被打劫", next:"ending_hobo_dead"} ] },
        hobo_escape_bandit: { text: "匪徒拿了面包放你走。", choices: [ {text:"赶紧离开", next:"hobo_river"} ] },
        hobo_beg_street: { text: "士兵对你不感兴趣，挥手让你走。", choices: [ {text:"趁机去河边", next:"hobo_river"} ] },

        ending_hobo_safe: { text: "系统：你被日军用刺刀刺死（流浪汉结局1）", choices: [] },
        ending_hobo_church: { text: "系统：你留在教堂，被日军坑杀（流浪汉结局2）", choices: [] },
        ending_hobo_river_escape: { text: "系统：你被守在墙外的日军发现并射杀（流浪汉结局3）", choices: [] },
        ending_hobo_caught: { text: "系统：你被巡逻士兵开枪射杀（流浪汉结局4）", choices: [] },
        ending_hobo_drown: { text: "系统：你跳河逃生失败，溺亡（流浪汉结局5）", choices: [] },
        ending_hobo_dead: { text: "系统：你被匪徒杀害（流浪汉结局6）", choices: [] }
},
车夫: {
        start: { text: "你是一名车夫，平日拉客维生。战火让你和马车困在城里。", choices: [ {text:"带上马车逃生", next:"driver_cart"}, {text:"先找粮草喂马", next:"driver_feed"}, {text:"去教堂避难", next:"driver_church"} ] },

        driver_cart: { text: "你驾着马车来到街上，遇到士兵盘查。", choices: [ {text:"用银钱贿赂", next:"driver_bribe"}, {text:"假装运送物资", next:"driver_fake"} ] },
        driver_bribe: { text: "士兵收下银钱后放你通行。", choices: [ {text:"继续前往西门", next:"driver_west"}, {text:"改走东门", next:"driver_east"} ] },
        driver_fake: { text: "士兵半信半疑，掀开你的马车帘子。", choices: [ {text:"保持镇定", next:"driver_check_pass"}, {text:"趁乱逃跑", next:"ending_driver_caught"} ] },
        driver_check_pass: { text: "士兵没有发现异常，挥手放行。", choices: [ {text:"驱车去西门", next:"driver_west"} ] },

        driver_feed: { text: "你找来些干草喂马。突然听到外面传来枪声。", choices: [ {text:"迅速驾车离开", next:"driver_cart"}, {text:"躲进马厩", next:"driver_hide"} ] },
        driver_hide: { text: "你藏在马厩里，士兵搜查但未发现你。", choices: [ {text:"等他们离开后上路", next:"driver_cart"} ] },

        driver_church: { text: "教堂里的修女看到你的马车，请你帮忙运送难民。", choices: [ {text:"答应", next:"driver_help_church"}, {text:"拒绝", next:"driver_cart"} ] },
        driver_help_church: { text: "你载着难民前往安全区。", choices: [ {text:"驶向西门", next:"driver_west"}, {text:"驶向河边", next:"driver_river"} ] },

        driver_west: { text: "西门有守军，你需要决定。", choices: [ {text:"贿赂守军", next:"ending_driver_west_escape"}, {text:"寻找旁边小路", next:"driver_secret"} ] },
        driver_secret: { text: "你找到一个被炸开的城墙缺口，成功避开守军。", choices: [ {text:"逃出城外", next:"ending_driver2_west_escape"} ] },

        driver_east: { text: "东门戒备森严。", choices: [ {text:"强行冲过去", next:"ending_driver_fail"}, {text:"放弃改走河边", next:"driver_river"} ] },

        driver_river: { text: "河边有船夫招手，但需要钱带你走。", choices: [ {text:"支付费用", next:"ending_driver_river_escape"}, {text:"自己划船", next:"ending_driver_river_escape"} ] },

        ending_driver_west_escape: { text: "系统：你因为贿赂守军被射杀（车夫结局1）", choices: [] },
        ending_driver2_west_escape: { text: "系统：你被守在城墙外的日军射杀（车夫结局2）", choices: [] },
        ending_driver_river_escape: { text: "系统：你被船夫打下水，淹死在长江（车夫结局3）", choices: [] },
        ending_driver_fail: { text: "系统：你在冲击东门时被射杀（车夫结局4）", choices: [] },
        ending_driver_caught: { text: "系统：你被士兵抓住并射杀（车夫结局5）", choices: [] }
},

};

    const identityList = document.getElementById('identity-list');
    const identityDesc = document.getElementById('identity-description');
    const identityTitle = document.getElementById('identity-title');
    const confirmBtn = document.getElementById('confirm-identity');
    const reselectBtn = document.getElementById('reselect-identity');
    const introText = document.getElementById('intro-text');

    identities.forEach(id => {
      const btn = document.createElement('button');
      btn.textContent = id;
      btn.classList.add('identity-btn');
      btn.addEventListener('click', () => showIdentityDescription(id));
      identityList.appendChild(btn);
    });

    function showIdentityDescription(id) {
      chosenIdentity = id;
      identityTitle.textContent = "当前身份：" + id;
      identityDesc.textContent = identityDialogues[id];
      introText.style.display = 'none';
      Array.from(identityList.children).forEach(btn => btn.style.display = 'none');
      confirmBtn.style.display = 'inline-block';
      reselectBtn.style.display = 'inline-block';
    }

    let chosenIdentity = null;
    document.getElementById('start-btn').addEventListener('click', () => {
      document.getElementById('title-screen').style.display = 'none';
      document.getElementById('identity-screen').style.display = 'flex';
    });

    confirmBtn.addEventListener('click', () => {
      if (!chosenIdentity) return;
      document.getElementById('identity-screen').style.display = 'none';
      document.getElementById('dialogue-container').style.display = 'flex';
      startDialogue('start');
    });

    reselectBtn.addEventListener('click', () => {
      identityTitle.textContent = "选择你的身份";
      identityDesc.textContent = '';
      introText.style.display = 'block';
      Array.from(identityList.children).forEach(btn => btn.style.display = 'inline-block');
      confirmBtn.style.display = 'none';
      reselectBtn.style.display = 'none';
      chosenIdentity = null;
    });

    function startDialogue(key) {
      const set = dialogues[chosenIdentity] || dialogues['市民'];
      const d = set[key];
      if (!d) return;
      document.getElementById('dialogue-text').textContent = d.text;
      const choicesContainer = document.getElementById('choices');
      choicesContainer.innerHTML = '';
      if (d.choices && d.choices.length > 0) {
        d.choices.forEach(choice => {
          const btn = document.createElement('button');
          btn.textContent = choice.text;
          btn.classList.add('choice-btn');
          btn.addEventListener('click', () => startDialogue(choice.next));
          choicesContainer.appendChild(btn);
        });
      } else {
        const btn = document.createElement('button');
        btn.textContent = '返回身份选择';
        btn.classList.add('choice-btn');
        btn.addEventListener('click', () => {
          document.getElementById('dialogue-container').style.display = 'none';
          document.getElementById('identity-screen').style.display = 'flex';
          identityTitle.textContent = "选择你的身份";
          identityDesc.textContent = '';
          introText.style.display = 'block';
          Array.from(identityList.children).forEach(btn => btn.style.display = 'inline-block');
          confirmBtn.style.display = 'none';
          reselectBtn.style.display = 'none';
        });
        choicesContainer.appendChild(btn);
      }
    }
  </script>
</body>
</html>
